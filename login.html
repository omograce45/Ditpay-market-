<!doctype html>
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <title>DitPay Marketplace</title>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>  
  <style>  
    :root{  
      --dp-primary:#0b3d91;  
      --dp-accent:#f4b400;  
      --bg:#f6f9fb;  
      --card:#ffffff;  
      --muted:#6b7280;  
      --radius:12px;  
      --shadow:0 6px 18px rgba(11,61,145,0.08);  
      --maxw:1200px;  
    }  
    *{box-sizing:border-box}  
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#0b1220}  
    .wrap{max-width:var(--maxw);margin:20px auto;padding:0 16px}  

    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
      flex-wrap:wrap;
      gap:10px;
    }  
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }  
    .logo{
      width:52px;
      height:52px;
      border-radius:14px;
      background:linear-gradient(135deg,var(--dp-primary),var(--dp-accent));
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:700;
      box-shadow:var(--shadow);
    }  
    .brand h1{margin:0;font-size:18px}  
    .top-actions{
      display:flex;
      gap:10px;
      align-items:center;
      width:100%;
      justify-content:space-between;
      flex-wrap:wrap;
    }  

    /* Keep header items (brand + logout) on one line, even on small screens */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: nowrap;
}

/* Logout button */
.logout-btn {  
  background: var(--dp-primary);  
  color: white;  
  border: 0;  
  padding: 6px 12px;  
  border-radius: 8px;  
  cursor: pointer;  
  font-weight: 600;  
  display: flex;  
  align-items: center;  
  gap: 4px;  
  box-shadow: var(--shadow);  
}  

.logout-btn i { font-size: 13px; }  

/* ✅ Adjust sizing on smaller screens */
@media (max-width: 600px) {
  .logout-btn {
    padding: 8px 12px;
    font-size: 14px;
  }

  .brand h1 {
    font-size: 25px;
  }

  .brand div[style] {
    font-size: 12px !important;
  }
}
 
    /* Search */  
    .search-bar{display:flex;gap:10px;background:var(--card);padding:10px;border-radius:12px;box-shadow:var(--shadow);align-items:center;width:100%}  
    .search-bar input{flex:1;border:0;outline:0;padding:8px;font-size:15px}  
    .search-bar select{border:0;background:transparent}  
    .search-btn{background:var(--dp-primary);color:white;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}  

    /* Layout */  
    .grid-layout{display:grid;grid-template-columns:240px 1fr;gap:18px;align-items:start}  
    aside{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow)}  

    /* Categories row */  
    .cat-row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}  
    .cat{background:linear-gradient(180deg,rgba(255,255,255,0.9),#fff);padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.04);cursor:pointer;font-size:14px;color:var(--muted)}  

    /* Products */  
    .results-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}  
    .results-count{color:var(--muted);font-size:14px}  
    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}  
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:var(--shadow);cursor:pointer;display:flex;flex-direction:column}  
    .card .img{height:170px;background:#eef6fb;overflow:hidden}  
    .card img{width:100%;height:100%;object-fit:cover;display:block}  
    .card .body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}  
    .price{color:var(--dp-primary);font-weight:700;font-size:16px}  
    .title{font-weight:600}  
    .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}  
    .seller{display:flex;align-items:center;gap:8px;margin-top:auto}  
    .seller img{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,0.06)}  
    .details-btn{background:var(--dp-accent);border:0;color:#0b2140;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600;margin-left:auto}  

    /* Responsive */  
    @media (max-width:1000px){.cards{grid-template-columns:repeat(2,1fr)}.grid-layout{grid-template-columns:200px 1fr}}  
    @media (max-width:720px){  
      header{flex-direction:column;align-items:stretch;gap:10px}  
      .grid-layout{grid-template-columns:1fr}  
      aside{order:2;display:none}  
      .cards{grid-template-columns:1fr}  
      .bottom-nav{display:flex}  
    }  

    /* Bottom nav */  
    .bottom-nav{  
      display:flex;  
      position:fixed;  
      left:0;  
      right:0;  
      bottom:0;  
      background:var(--card);  
      box-shadow:0 -6px 18px rgba(0,0,0,0.06);  
      padding:8px 12px;  
      border-top-left-radius:12px;  
      border-top-right-radius:12px;  
      z-index:60;  
    }  
    .bottom-nav ul{  
      display:flex;  
      justify-content:space-around;  
      align-items:center;  
      width:100%;  
      margin:0;  
      padding:0;  
      list-style:none;  
    }  
    .bottom-nav li{  
      flex:1;  
      text-align:center;  
      color:var(--muted);  
      font-size:13px;  
      cursor:pointer;  
    }  
    .bottom-nav li.active{  
      color:var(--dp-primary);  
    }  
    .bottom-nav i{  
      font-size:18px;  
      display:block;  
      margin-bottom:4px;  
    }  
  </style>  
</head>  
<body>  
  <div class="wrap">  
    <header>  
      <div class="brand">  
        <div class="logo">DP</div>  
        <div>  
          <h1>DitPay Market</h1>  
          <div style="font-size:13px;color:var(--muted)">Buy & sell in your city</div>  
        </div>  
      </div>  

      <!-- ✅ Logout button now next to brand (same line) -->
      <div class="header-right">
        <button id="logoutBtn" class="logout-btn">
          <i class="fa fa-sign-out-alt"></i>Logout
        </button>
      </div>
    </header>  

    <div class="top-actions">  
      <div class="search-bar" role="search">  
        <input id="searchInput" placeholder="Search items, e.g. iPhone, motorcycle..." aria-label="Search" />  
        <select id="catSelect">  
          <option value="all">All categories</option>  
          <option value="electronics">Electronics</option>  
          <option value="vehicles">Vehicles</option>  
          <option value="property">Property</option>  
          <option value="services">Services</option>  
          </select>  
          <button id="searchBtn" class="search-btn"><i class="fa fa-search"></i></button>  
        </div> 
      </div>  
    </header>  <div class="grid-layout">  
  <aside>  
    <h4>Location</h4>  
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">  
      <div class="cat loc">Lagos</div><div class="cat loc">Abuja</div><div class="cat loc">Port Harcourt</div><div class="cat loc">Ibadan</div>  
    </div>  
    <h4>Condition</h4>  
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">  
      <div class="cat cond">New</div><div class="cat cond">Used</div><div class="cat cond">Refurbished</div>  
    </div>  
    <h4>Price</h4>  
    <div style="display:flex;gap:8px;margin-bottom:8px">  
      <input id="minPrice" type="number" placeholder="Min" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e9eef0"/>  
      <input id="maxPrice" type="number" placeholder="Max" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e9eef0"/>  
    </div>  
    <button id="applyFilters" class="details-btn" style="width:100%;background:var(--dp-primary);color:white">Apply filters</button>  
  </aside>  

  <main>  
    <div class="results-head">  
      <div class="results-count"><span id="resultsCount">0</span> results</div>  
      <div style="display:flex;gap:8px;align-items:center">  
        <select id="sort">  
          <option value="newest">Newest</option>  
          <option value="price-asc">Price: low → high</option>  
          <option value="price-desc">Price: high → low</option>  
        </select>  
      </div>  
    </div>  

    <div class="cat-row">  
      <div class="cat" data-cat="electronics">Electronics</div>  
      <div class="cat" data-cat="vehicles">Vehicles</div>  
      <div class="cat" data-cat="property">Property</div>  
      <div class="cat" data-cat="services">Services</div>  
    </div>  

    <section class="cards" id="cards"></section>  
  </main>  
</div>

  </div>    <!-- ✅ Bottom Navigation -->    <nav class="bottom-nav">  
    <ul id="bottomNav">  
      <li class="active" data-action="home">  
        <i class="fa fa-home"></i>Home  
      </li>  
      <li data-action="about">  
        <i class="fa fa-info-circle"></i>About  
      </li>  
      <li data-action="messages">  
        <i class="fa fa-comments"></i><span>Messages</span>  
      </li>  
      <li data-action="profile">  
        <i class="fa fa-user"></i>Profile  
      </li>  
    </ul>  
  </nav>   
  <script>  
    
// === Fetch from backend first ===
async function loadPosts() {
  try {
    const res = await fetch('https://dittpay-market.onrender.com/api/post');
    const data = await res.json();

    if (Array.isArray(data) && data.length > 0) {
      // If backend has data, replace sample data with it
      DATA = data.map(p => ({
        id: p.id,
        title: p.title,
        price: p.price,
        cat: p.category,
        city: p.city,
        seller: p.username,
        sellerImg: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&q=60',
        img: p.image || 'https://via.placeholder.com/400',
        desc: p.description
      }));
    }
    render(DATA);
  } catch (err) {
    console.error('Error loading posts:', err);
    render(DATA); // fallback to sample data
  }
}

// === Sample Data ===  
let DATA = [  
  {id:1,title:'iPhone 13 Pro Max - 256GB',price:720000,cat:'electronics',city:'Lagos',seller:'Grace Phones',sellerImg:'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&q=60',img:'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200&q=60',desc:'Excellent condition, battery 90%.'},  
  {id:2,title:'MacBook Pro 2020 - 16GB',price:520000,cat:'electronics',city:'Ibadan',seller:'TechHub Gadgets',sellerImg:'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=200&q=60',img:'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=1200&q=60',desc:'Lightly used, like new.'},  
  {id:3,title:'Samsung Galaxy A54',price:98000,cat:'electronics',city:'Lagos',seller:'SmartHome NG',sellerImg:'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&q=60',img:'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=1200&q=60',desc:'Box & accessories included.'},
  {
    id: 4,
    title: 'Oraimo 2A Fast Charger',
    price: 5500,
    cat: 'electronics',
    city: 'Lagos',
    seller: 'TechHub Stores',
    sellerImg: 'https://images.unsplash.com/photo-1596218416735-7b89b4b8a6b8?w=200&q=60',
    img: 'https://images.unsplash.com/photo-1603791452906-bb7b64a1e2a0?w=1200&q=60',
    desc: 'Original Oraimo charger with fast charging capability. 6 months warranty.'
  },
  {
    id: 5,
    title: 'Oraimo FreePods 4',
    price: 22000,
    cat: 'electronics',
    city: 'Benin City',
    seller: 'Mobile Zone',
    sellerImg: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=200&q=60',
    img: 'https://images.unsplash.com/photo-1585386959984-a41552231693?w=1200&q=60',
    desc: 'Noise-cancelling Oraimo FreePods 4 with deep bass and long battery life.'
  },
  {
    id: 6,
    title: 'Oraimo Type-C Cable - 1m',
    price: 2500,
    cat: 'electronics',
    city: 'Benin city',
    seller: 'Gadget Plaza',
    sellerImg: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=200&q=60',
    img: 'https://images.unsplash.com/photo-1618354691551-61d3a0d3f0ae?w=1200&q=60',
    desc: 'Durable Oraimo Type-C cable compatible with all Android devices.'
  },
  {
    id: 7,
    title: 'Oraimo Power Bank 20000mAh',
    price: 16500,
    cat: 'electronics',
    city: 'Benin City',
    seller: 'Digital Point',
    sellerImg: 'https://images.unsplash.com/photo-1531297484001-80022131f5a1?w=200&q=60',
    img: 'https://images.unsplash.com/photo-1619546813926-a78fa6372cd2?w=1200&q=60',
    desc: 'High-capacity Oraimo power bank, supports fast charging with dual output.'
  },
  {
    id: 8,
    title: 'AirPods Pro (2nd Gen)',
    price: 135000,
    cat: 'electronics',
    city: 'Benin City',
    seller: 'Apple Store NG',
    sellerImg: 'https://images.unsplash.com/photo-1605460375648-278bcbd579a6?w=200&q=60',
    img: 'https://unsplash.com/photos/black-battery-beside-laptop-qQYS_ifJiGQ',
    desc: 'Brand new Apple AirPods Pro with noise cancellation and wireless charging case.'
  },
  {id:9,title:'Cleaning service - weekly',price:15000,cat:'services',city:'Port Harcourt',seller:'CleanPros',sellerImg:'https://images.unsplash.com/photo-1545996124-1b9f77a0f6e4?w=200&q=60',img:'https://images.unsplash.com/photo-1505751172876-fa1923c5c528?w=1200&q=60',desc:'Professional team.'}  
];  
  
const cardsEl = document.getElementById('cards');  
const resultsCount = document.getElementById('resultsCount');  
let items = [...DATA];  
  
function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',')}  
  
function render(list){  
  cardsEl.innerHTML='';  
  if(list.length===0){ cardsEl.innerHTML='<div style="padding:24px;color:var(--muted)">No items found.</div>'; resultsCount.textContent=0; return; }  
  resultsCount.textContent = list.length;  
  list.forEach(i=>{  
    const card = document.createElement('article');  
    card.className='card';  
    card.innerHTML = `  
      <div class="img"><img src="${i.img}" alt="${i.title}"></div>  
      <div class="body">  
        <div style="display:flex;justify-content:space-between;align-items:start;gap:10px">  
          <div style="flex:1">  
            <div class="title">${i.title}</div>  
            <div class="price">₦${numberWithCommas(i.price)}</div>  
          </div>  
          <div style="text-align:right;color:var(--muted);font-size:13px">${i.city}</div>  
        </div>  
        <div class="meta">${i.desc}</div>  
        <div class="seller">  
          <div style="display:flex;flex-direction:column"><small style="color:var(--muted);font-size:12px">Seller</small><strong>${i.seller}</strong></div>  
          <img src="${i.sellerImg}" alt="${i.seller}"/>  
          <button class="details-btn" data-id="${i.id}">View Details</button>  
        </div>  
      </div>  
    `;  
    // make whole card clickable  
    card.addEventListener('click', (e)=>{  
      if(e.target.closest('.details-btn')) return;  
      window.location.href = 'product.html?id=' + i.id;  
    });  
    const btn = card.querySelector('.details-btn');  
    btn.addEventListener('click',(ev)=>{  
      ev.stopPropagation();  
      window.location.href = 'product.html?id=' + i.id;  
    });  
    cardsEl.appendChild(card);  
  });  
}  
  
render(items);  
  
// === Search and Filters ===  
const searchInput = document.getElementById('searchInput');  
const searchBtn = document.getElementById('searchBtn');  
const catSelect = document.getElementById('catSelect');  
const minPrice = document.getElementById('minPrice');  
const maxPrice = document.getElementById('maxPrice');  
const applyFilters = document.getElementById('applyFilters');  
  
function applySearchAndFilters(){  
  const q = (searchInput.value || '').toLowerCase();  
  const cat = (catSelect.value || 'all');  
  const min = Number(minPrice.value) || 0;  
  const max = Number(maxPrice.value) || Infinity;  
  let filtered = DATA.filter(item=>{  
    const matchesQ = item.title.toLowerCase().includes(q) || item.seller.toLowerCase().includes(q) || item.city.toLowerCase().includes(q);  
    const matchesCat = cat==='all' || item.cat===cat;  
    const matchesPrice = item.price >= min && item.price <= max;  
    return matchesQ && matchesCat && matchesPrice;  
  });  
  items = filtered;  
  render(items);  
}  
  
searchBtn.addEventListener('click', applySearchAndFilters);  
searchInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') applySearchAndFilters(); });  
applyFilters.addEventListener('click', applySearchAndFilters);  
catSelect.addEventListener('change', applySearchAndFilters);  
document.getElementById('sort').addEventListener('change', ()=>{  
  const v = document.getElementById('sort').value;  
  if(v==='price-asc') items.sort((a,b)=>a.price-b.price);  
  else if(v==='price-desc') items.sort((a,b)=>b.price-a.price);  
  else items.sort((a,b)=>b.id-a.id);  
  render(items);  
});  
  
// === Category Quick Filters ===  
document.querySelectorAll('.cat[data-cat]').forEach(el=>el.addEventListener('click', ()=>{  
  catSelect.value = el.dataset.cat;  
  applySearchAndFilters();  
  window.scrollTo({top:200,behavior:'smooth'});  
}));

// === Load posts on startup ===
loadPosts();
    
    // === Logout Function ===  
    document.getElementById('logoutBtn').addEventListener('click', ()=>{  
      localStorage.removeItem('token');  
      sessionStorage.clear();  
      window.location.href = 'index.html';  
    });  
  
    // === Bottom Navigation Logic ===  
    const navItems = document.querySelectorAll('#bottomNav li');  
    navItems.forEach(item => {  
      item.addEventListener('click', () => {  
        navItems.forEach(i => i.classList.remove('active'));  
        item.classList.add('active');  
        const action = item.dataset.action;  
  
        switch (action) {  
          case 'home':  
            window.location.href = 'login.html';  
            break;  
          case 'about':  
            window.location.href = 'about.html';  
            break;  
          case 'messages':  
            window.location.href = 'messages.html';  
            break;  
          case 'profile':  
            window.location.href = 'profile.html';  
            break;  
        }  
      });  
    }); 
    
    // === Reload posts if a new one was added ===
window.addEventListener("focus", () => {
  if (localStorage.getItem("newPostAdded") === "true") {
    loadPosts(); // fetch fresh posts
    localStorage.removeItem("newPostAdded");
  }
});

  </script>  </body>  
</html>
